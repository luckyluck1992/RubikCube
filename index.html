
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

  <title>Rubik Cube</title>

  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/freshfork/p5.EasyCam@1.0.10/p5.easycam.min.js"></script>
  <script src="https://unpkg.com/mathjs@9.4.4/lib/browser/math.js"></script>
</head>

<body>
  <script >

  function extround(zahl,n_stelle) {
    zahl = (Math.round(zahl * n_stelle) / n_stelle);
      return zahl;
  }

  function rotVectorX(e) {
    let ey = e[1];
    let ez = e[2];

    return [e[0],ey * math.cos(math.pi/50) - ez * math.sin(math.pi/50), ey * math.sin(math.pi/50) + ez * math.cos(math.pi/50)];

  }

  function rotVectorXb(e) {
    let ey = e[1];
    let ez = e[2];

    return [e[0],ey * math.cos(-math.pi/50) - ez * math.sin(-math.pi/50), ey * math.sin(-math.pi/50) + ez * math.cos(-math.pi/50)];

  }

  function rotVectorY(e) {
    let ex = e[0];
    let ez = e[2];

    return [ex * math.cos(math.pi/50) - ez * math.sin(math.pi/50),e[1],ex * math.sin(math.pi/50) + ez * math.cos(math.pi/50)];


  }

  function rotVectorYb(e) {
    let ex = e[0];
    let ez = e[2];

    return [ex * math.cos(-math.pi/50) - ez * math.sin(-math.pi/50),e[1],ex * math.sin(-math.pi/50) + ez * math.cos(-math.pi/50)];

  }

  function rotVectorZ(e) {
    let ey = e[1];
    let ex = e[0];

    return [ex * math.cos(math.pi/50) - ey * math.sin(math.pi/50),ex * math.sin(math.pi/50) + ey * math.cos(math.pi/50),e[2]];

  }

  function rotVectorZb(e) {
    let ey = e[1];
    let ex = e[0];

    return [ex * math.cos(-math.pi/50) - ey * math.sin(-math.pi/50),ex * math.sin(-math.pi/50) + ey * math.cos(-math.pi/50),e[2]];

  }

  let a = 1;
  class Cubie {

    constructor(x,y,z) {
      this.x = x;
      this.y = y;
      this.z = z;
    this.highlight = false;
    this.rotate = 0;
    this.rotationstep = 0;
    this.angle = 0;
    this.e1 = [1,0,0];
    this.e2 = [0,1,0];
    this.e3 = [0,0,1];
    }
    show() {

    if(this.rotate == 1) {
      if(this.rotationstep != 1) {
        let calcy = this.y;
        let calcz = this.z;
        this.y = calcy * math.cos(math.pi/50) - calcz * math.sin(math.pi/50);
        this.z = calcy * math.sin(math.pi/50) + calcz * math.cos(math.pi/50);

        this.e1 = rotVectorX(this.e1);

        this.e2 = rotVectorX(this.e2);

        this.e3 = rotVectorX(this.e3);


        this.angle = extround(this.angle + 3.6, 10);
        this.rotationstep = extround(this.rotationstep + 0.04, 100);
      }else {
        let calcy = this.y;
        let calcz = this.z;
        this.y = round(calcy * math.cos(math.pi/50) - calcz * math.sin(math.pi/50));
        this.z = round(calcy * math.sin(math.pi/50) + calcz * math.cos(math.pi/50));
        this.rotationstep = 0;
        this.rotate = 0;
        this.angle = 0;

        this.e1[0] = round(this.e1[0]);
        this.e1[1] = round(this.e1[1]);
        this.e1[2] = round(this.e1[2]);
        this.e2[0] = round(this.e2[0]);
        this.e2[1] = round(this.e2[1]);
        this.e2[2] = round(this.e2[2]);
        this.e3[0] = round(this.e3[0]);
        this.e3[1] = round(this.e3[1]);
        this.e3[2] = round(this.e3[2]);

      }
    }

    if(this.rotate == 2) {
      if(this.rotationstep != 1) {
        let calcx = this.x;
        let calcz = this.z;
        this.x = calcx * math.cos(math.pi/50) - calcz * math.sin(math.pi/50);
        this.z = calcx * math.sin(math.pi/50) + calcz * math.cos(math.pi/50);

        this.e1 = rotVectorY(this.e1);

        this.e2 = rotVectorY(this.e2);

        this.e3 = rotVectorY(this.e3);


        this.angle = extround(this.angle + 3.6, 10);
        this.rotationstep = extround(this.rotationstep + 0.04, 100);
      }else {
        let calcx = this.x;
        let calcz = this.z;
        this.x = round(calcx * math.cos(math.pi/50) - calcz * math.sin(math.pi/50));
        this.z = round(calcx * math.sin(math.pi/50) + calcz * math.cos(math.pi/50));
        this.rotationstep = 0;
        this.rotate = 0;
        this.angle = 0;

        this.e1[0] = round(this.e1[0]);
        this.e1[1] = round(this.e1[1]);
        this.e1[2] = round(this.e1[2]);
        this.e2[0] = round(this.e2[0]);
        this.e2[1] = round(this.e2[1]);
        this.e2[2] = round(this.e2[2]);
        this.e3[0] = round(this.e3[0]);
        this.e3[1] = round(this.e3[1]);
        this.e3[2] = round(this.e3[2]);

      }
    }

    if(this.rotate == 3) {
      if (this.rotationstep !=1) {
        let calcx = this.x;
        let calcy = this.y;
        this.x = calcx * math.cos(math.pi/50) - calcy * math.sin(math.pi/50);
        this.y = calcx * math.sin(math.pi/50) + calcy * math.cos(math.pi/50);
        this.e1 = rotVectorZ(this.e1);

        this.e2 = rotVectorZ(this.e2);

        this.e3 = rotVectorZ(this.e3);

        this.angle = extround(this.angle + 3.6, 10);
        this.rotationstep = extround(this.rotationstep + 0.04, 100);
      }else {
        let calcx = this.x;
        let calcy = this.y;
        this.x = round(calcx * math.cos(math.pi/50) - calcy * math.sin(math.pi/50));
        this.y = round(calcx * math.sin(math.pi/50) + calcy * math.cos(math.pi/50));

        this.rotationstep = 0;
        this.rotate = 0;
        this.angle = 0;

        this.e1[0] = round(this.e1[0]);
        this.e1[1] = round(this.e1[1]);
        this.e1[2] = round(this.e1[2]);
        this.e2[0] = round(this.e2[0]);
        this.e2[1] = round(this.e2[1]);
        this.e2[2] = round(this.e2[2]);
        this.e3[0] = round(this.e3[0]);
        this.e3[1] = round(this.e3[1]);
        this.e3[2] = round(this.e3[2]);



      }

    }

    if(this.rotate == 4) {
      if(this.rotationstep != 1) {
        let calcy = this.y;
        let calcz = this.z;
        this.y = calcy * math.cos(-math.pi/50) - calcz * math.sin(-math.pi/50);
        this.z = calcy * math.sin(-math.pi/50) + calcz * math.cos(-math.pi/50);

        this.e1 = rotVectorXb(this.e1);

        this.e2 = rotVectorXb(this.e2);

        this.e3 = rotVectorXb(this.e3);


        this.angle = extround(this.angle + 3.6, 10);
        this.rotationstep = extround(this.rotationstep + 0.04, 100);
      }else {
        let calcy = this.y;
        let calcz = this.z;
        this.y = round(calcy * math.cos(-math.pi/50) - calcz * math.sin(-math.pi/50));
        this.z = round(calcy * math.sin(-math.pi/50) + calcz * math.cos(-math.pi/50));
        this.rotationstep = 0;
        this.rotate = 0;
        this.angle = 0;

        this.e1[0] = round(this.e1[0]);
        this.e1[1] = round(this.e1[1]);
        this.e1[2] = round(this.e1[2]);
        this.e2[0] = round(this.e2[0]);
        this.e2[1] = round(this.e2[1]);
        this.e2[2] = round(this.e2[2]);
        this.e3[0] = round(this.e3[0]);
        this.e3[1] = round(this.e3[1]);
        this.e3[2] = round(this.e3[2]);


      }
    }


    if(this.rotate == 5) {
      if(this.rotationstep != 1) {
        let calcx = this.x;
        let calcz = this.z;
        this.x = calcx * math.cos(-math.pi/50) - calcz * math.sin(-math.pi/50);
        this.z = calcx * math.sin(-math.pi/50) + calcz * math.cos(-math.pi/50);

        this.e1 = rotVectorYb(this.e1);

        this.e2 = rotVectorYb(this.e2);

        this.e3 = rotVectorYb(this.e3);

        this.angle = extround(this.angle + 3.6, 10);
        this.rotationstep = extround(this.rotationstep + 0.04, 100);
      }else {
        let calcx = this.x;
        let calcz = this.z;
        this.x = round(calcx * math.cos(-math.pi/50) - calcz * math.sin(-math.pi/50));
        this.z = round(calcx * math.sin(-math.pi/50) + calcz * math.cos(-math.pi/50));
        this.rotationstep = 0;
        this.rotate = 0;
        this.angle = 0;

        this.e1[0] = round(this.e1[0]);
        this.e1[1] = round(this.e1[1]);
        this.e1[2] = round(this.e1[2]);
        this.e2[0] = round(this.e2[0]);
        this.e2[1] = round(this.e2[1]);
        this.e2[2] = round(this.e2[2]);
        this.e3[0] = round(this.e3[0]);
        this.e3[1] = round(this.e3[1]);
        this.e3[2] = round(this.e3[2]);

      }
    }

    if(this.rotate == 6) {
      if (this.rotationstep !=1) {
        let calcx = this.x;
        let calcy = this.y;
        this.x = calcx * math.cos(-math.pi/50) - calcy * math.sin(-math.pi/50);
        this.y = calcx * math.sin(-math.pi/50) + calcy * math.cos(-math.pi/50);
        this.e1 = rotVectorZb(this.e1);

        this.e2 = rotVectorZb(this.e2);

        this.e3 = rotVectorZb(this.e3);

        this.angle = extround(this.angle + 3.6, 10);
        this.rotationstep = extround(this.rotationstep + 0.04, 100);
      }else {
        let calcx = this.x;
        let calcy = this.y;
        this.x = round(calcx * math.cos(-math.pi/50) - calcy * math.sin(-math.pi/50));
        this.y = round(calcx * math.sin(-math.pi/50) + calcy * math.cos(-math.pi/50));

        this.rotationstep = 0;
        this.rotate = 0;
        this.angle = 0;

        this.e1[0] = round(this.e1[0]);
        this.e1[1] = round(this.e1[1]);
        this.e1[2] = round(this.e1[2]);
        this.e2[0] = round(this.e2[0]);
        this.e2[1] = round(this.e2[1]);
        this.e2[2] = round(this.e2[2]);
        this.e3[0] = round(this.e3[0]);
        this.e3[1] = round(this.e3[1]);
        this.e3[2] = round(this.e3[2]);



      }

    }





      push();

      translate(this.x-(this.e1[0]+this.e2[0]+this.e3[0])/2 ,this.y-(this.e1[1]+this.e2[1]+this.e3[1])/2 ,this.z-(this.e1[2]+this.e2[2]+this.e3[2])/2);
      beginShape();

      fill(0,255,0);
      vertex(0,0,0);
      vertex(this.e1[0],this.e1[1],this.e1[2]);
      vertex(this.e1[0] + this.e2[0] ,this.e1[1] + this.e2[1],this.e1[2] + this.e2[2]);
      vertex(this.e2[0],this.e2[1],this.e2[2]);
      endShape();

      beginShape();
      fill(0,0,255);
      vertex(this.e3[0],this.e3[1],this.e3[2]);
      vertex(this.e1[0] + this.e3[0],this.e1[1] + this.e3[1] ,this.e1[2] + this.e3[2]);
      vertex(this.e1[0] + this.e2[0] + this.e3[0], this.e1[1] + this.e2[1] + this.e3[1],this.e1[2] + this.e2[2] + this.e3[2]);
      vertex(this.e2[0] + this.e3[0],this.e2[1] + this.e3[1],this.e2[2] + this.e3[2]);
      endShape();

      beginShape();
      fill(255,255,0);
      vertex(0,0,0);
      vertex(this.e1[0],this.e1[1],this.e1[2]);
      vertex(this.e1[0] + this.e3[0], this.e1[1] + this.e3[1], this.e1[2]+ this.e3[2]);
      vertex(this.e3[0],this.e3[1],this.e3[2]);
      endShape();

      beginShape();
      fill(255);
      vertex(this.e2[0], this.e2[1], this.e2[2]);
      vertex(this.e1[0] + this.e2[0],this.e1[1] + this.e2[1], this.e1[2] + this.e2[2]);
      vertex(this.e1[0]+ this.e3[0] + this.e2[0], this.e1[1] + this.e3[1] + this.e2[1], this.e1[2] + this.e3[2] + this.e2[2]);
      vertex(this.e3[0]+ this.e2[0],this.e3[1] + this.e2[1],this.e3[2] + this.e2[2]);
      endShape();

      beginShape();
      fill(255,165,0);
      vertex(0,0,0);
      vertex(this.e2[0],this.e2[1],this.e2[2]);
      vertex(this.e2[0]+ this.e3[0], this.e2[1] + this.e3[1],this.e2[2] + this.e3[2]);
      vertex(this.e3[0], this.e3[1], this.e3[2]);
      endShape();

      beginShape();
      fill(255,0,0);
      vertex(this.e1[0], this.e1[1], this.e1[2]);
      vertex(this.e2[0] + this.e1[0],this.e2[1] + this.e1[1], this.e2[2] + this.e1[2]);
      vertex(this.e2[0] + this.e3[0] + this.e1[0], this.e2[1] + this.e3[1] + this.e1[1],this.e2[2] + this.e3[2] + this.e1[2]);
      vertex(this.e3[0] + this.e1[0], this.e3[1] + this.e1[1], this.e3[2] + this.e1[2]);
      endShape();

      pop();

    }
  }

  function createControl() {

  	//UP--Down

  	let canvasControlUpDown = document.createElement('div');
  	canvasControlUpDown.id = "canvasControlUpDown";
  	document.body.appendChild(canvasControlUpDown);

  	let btnUp = document.createElement('Button');
  	btnUp.id = "up";
  	canvasControlUpDown.appendChild(btnUp);

  	btnUp.addEventListener("click", function() {
  		turnY(-1);
  	});

  	btnUp.innerHTML = "Up";

  	let btnUpb = document.createElement('Button');
  	btnUpb.id = "upb";
  	canvasControlUpDown.appendChild(btnUpb);

  	btnUpb.addEventListener("click", function() {
  		turnYb(-1);
  	});

  	btnUpb.innerHTML = "Upb";

  	let btnDown = document.createElement('Button');
  	btnDown.id = "down";
  	canvasControlUpDown.appendChild(btnDown);

  	btnDown.addEventListener("click", function() {
  		turnYb(1);
  	});

  	btnDown.innerHTML = "Down";

  	let btnDownb = document.createElement('Button');
  	btnDownb.id = "Downb";
  	canvasControlUpDown.appendChild(btnDownb);

  	btnDownb.addEventListener("click", function() {
  		turnY(1);
  	});

  	btnDownb.innerHTML = "Downb";

  	//LEFT--RIGHT

  	let canvasControlLeftRight = document.createElement('div');
  	canvasControlLeftRight.id = "canvasControlLeftRight";
  	document.body.appendChild(canvasControlLeftRight);

  	let btnLeft = document.createElement('Button');
  	btnLeft.id = "Left";
  	canvasControlLeftRight.appendChild(btnLeft);

  	btnLeft.addEventListener("click", function() {
  		turnXb(-1);
  	});

  	btnLeft.innerHTML = "Left";

  	let btnLeftb = document.createElement('Button');
  	btnLeftb.id = "Leftb";
  	canvasControlLeftRight.appendChild(btnLeftb);

  	btnLeftb.addEventListener("click", function() {
  		turnX(-1);
  	});

  	btnLeftb.innerHTML = "Leftb";

  	let btnRight = document.createElement('Button');
  	btnRight.id = "Right";
  	canvasControlLeftRight.appendChild(btnRight);

  	btnRight.addEventListener("click", function() {
  		turnX(1);
  	});

  	btnRight.innerHTML = "Right";

  	let btnRightb = document.createElement('Button');
  	btnRightb.id = "Rightb";
  	canvasControlLeftRight.appendChild(btnRightb);

  	btnRightb.addEventListener("click", function() {
  		turnXb(1);
  	});

  	btnRightb.innerHTML = "Rightb";

  	//FRONT--BACK

  	let canvasControlFrontBack = document.createElement('div');
  	canvasControlFrontBack.id = "canvasControlFrontBack";
  	document.body.appendChild(canvasControlFrontBack);

  	let btnFront = document.createElement('Button');
  	btnFront.id = "Front";
  	canvasControlFrontBack.appendChild(btnFront);

  	btnFront.addEventListener("click", function() {
  		turnZ(1);
  	});

  	btnFront.innerHTML = "Front";

  	let btnFrontb = document.createElement('Button');
  	btnFrontb.id = "Frontb";
  	canvasControlFrontBack.appendChild(btnFrontb);

  	btnFrontb.addEventListener("click", function() {
  		turnZb(1);
  	});

  	btnFrontb.innerHTML = "Frontb";

  	let btnBack = document.createElement('Button');
  	btnBack.id = "Back";
  	canvasControlFrontBack.appendChild(btnBack);

  	btnBack.addEventListener("click", function() {
  		turnZb(-1);
  	});

  	btnBack.innerHTML = "Back";

  	let btnBackb = document.createElement('Button');
  	btnBackb.id = "Bakcb";
  	canvasControlFrontBack.appendChild(btnBackb);

  	btnBackb.addEventListener("click", function() {
  		turnZ(-1);
  	});

  	btnBackb.innerHTML = "Backb";


  	//SHUFFLE--SOLVE
  	let canvasControlShuffleSolve = document.createElement('div');
  	canvasControlShuffleSolve.id = "canvasControlShuffleSolve";
  	document.body.appendChild(canvasControlShuffleSolve);

  	let btnShuffle = document.createElement('Button');
  	btnShuffle.id = "shuffle";

  	canvasControlShuffleSolve.appendChild(btnShuffle);

  	btnShuffle.addEventListener("click", function() {
  		shuffling();
  	});

  	btnShuffle.innerHTML = "Shuffle";



  	let btnSolve = document.createElement('Button');
  	btnSolve.id = "solve";
  	canvasControlShuffleSolve.appendChild(btnSolve);

  	btnSolve.addEventListener("click", function() {
  		solve();
  	});

  	btnSolve.innerHTML = "Solve";

  }


  let cam;

  const cube = [];
  let index = 0;
  let mix = [];
  function setup() {
    // Disable the context menu on the canvas so the camera can use the right mouse button
  	createCanvas(500, 500, WEBGL).elt.oncontextmenu = () => false;

    createControl();

    cam = createEasyCam({
  	distance: 400,
    });

    angleMode(DEGREES);
      for (let x = -1; x <= 1; x++) {
  	  for (let y = -1; y <= 1; y++) {
          for (let z = -1; z <= 1; z++) {

  		cube[index] = new Cubie(x,y,z,0);
  		index++;
  		}
  	  }
  	}
  }
  function turnX(part) {
  	for(let i = 0; i < cube.length; i++) {
  		if(cube[i].x == part) {
  			cube[i].rotate = 1;
  		}
  	}
  }

  function turnY(part) {
  	for(let i = 0; i < cube.length; i++) {
  		if(cube[i].y == part) {
  			cube[i].rotate = 2;
  		}
  	}
  }

  function turnZ(part) {
  	for(let i = 0; i < cube.length; i++) {
  		if(cube[i].z == part) {
  			cube[i].rotate = 3;
  		}
  	}
  }

  function turnXb(part) {
  	for(let i = 0; i < cube.length; i++) {
  		if(cube[i].x == part) {
  			cube[i].rotate = 4;
  		}
  	}
  }

  function turnYb(part) {
  	for(let i = 0; i < cube.length; i++) {
  		if(cube[i].y == part) {
  			cube[i].rotate = 5;
  		}
  	}
  }

  function turnZb(part) {
  	for(let i = 0; i < cube.length; i++) {
  		if(cube[i].z == part) {
  			cube[i].rotate = 6;
  		}
  	}
  }

  function keyPressed() {
  	if( key == '1') {
  		turnZ(-1);
  	}
  	if( key == '2') {
  		turnZ(0);
  	}
  	if( key == '3') {
  		turnZ(1);
  	}
  	if( key == '4') {
  		turnY(-1);
  	}
  	if( key == '5') {
  		turnY(0);
  	}
  	if( key == '6') {
  		turnY(1);
  	}
  	if( key == '7') {
  		turnX(-1);
  	}
  	if( key == '8') {
  		turnX(0);
  	}
  	if( key == '9') {
  		turnX(1);
  	}

  }


  function draw() {
    background(51);
    scale(50);
    for (let i = 0; i < cube.length; i++) {
          cube[i].show();
    }
  }


  function Sleep(milliseconds) {
   return new Promise(resolve => setTimeout(resolve, milliseconds));
  }


  async function shuffling() {
  	let moves = ["up", "upb", "down", "downb",
  				"left", "leftb", "right", "rightb",
  				"front", "frontb", "back", "backb"];
  	for( let i = 0; i < 25; i++) {
  		mix[i] = moves[math.floor(math.random() * 12)];
  	}
  	console.log(mix);
  	for (let i = 0; i < mix.length; i++) {
  		console.log(mix[i]);

  		if(mix[i] === "up") {
  			turnY(-1);
  		}
  		if(mix[i] === "upb") {
  			turnYb(-1);
  		}
  		if(mix[i] === "down") {
  			turnYb(1);
  		}
  		if(mix[i] === "downb") {
  			turnYb(1);
  		}
  		if(mix[i] === "left") {
  			turnXb(-1);
  		}
  		if(mix[i] === "leftb") {
  			turnX(-1);
  		}
  		if(mix[i] === "right") {
  			turnX(1);
  		}
  		if(mix[i] === "rightb") {
  			turnXb(1);
  		}
  		if(mix[i] === "front") {
  			turnZ(-1);
  		}
  		if(mix[i] === "frontb") {
  			turnZb(-1);
  		}
  		if(mix[i] === "back") {
  			turnZb(1);
  		}
  		if(mix[i] === "backb") {
  			turnZ(1);
  		}
  		await Sleep(1200);
  	}
  	console.log("suffled...");
  }

  async function solve() {
  	console.log("start to solve...");

  	for (let i = mix.length-1; i >= 0; i--) {
  		console.log(i);

  		if(mix[i] === "up") {
  			turnYb(-1);
  		}
  		if(mix[i] === "upb") {
  			turnY(-1);
  		}
  		if(mix[i] === "down") {
  			turnY(1);
  		}
  		if(mix[i] === "downb") {
  			turnY(1);
  		}
  		if(mix[i] === "left") {
  			turnX(-1);
  		}
  		if(mix[i] === "leftb") {
  			turnXb(-1);
  		}
  		if(mix[i] === "right") {
  			turnXb(1);
  		}
  		if(mix[i] === "rightb") {
  			turnX(1);
  		}
  		if(mix[i] === "front") {
  			turnZb(-1);
  		}
  		if(mix[i] === "frontb") {
  			turnZ(-1);
  		}
  		if(mix[i] === "back") {
  			turnZ(1);
  		}
  		if(mix[i] === "backb") {
  			turnZb(1);
  		}
  		await Sleep(1200);
  	}
  }
  </script>
</body>

</html>
